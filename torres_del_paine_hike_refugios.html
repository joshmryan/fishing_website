<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Doctor Dry Fly - The Refugio System</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-9FBWPJ5ZFQ"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-9FBWPJ5ZFQ', { 'anonymize_ip': true});
</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Doctor Dry Fly</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./fishing_landing.html" rel="" target="">
 <span class="menu-text">Fly Fishing in the West</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./adventures_landing.html" rel="" target="">
 <span class="menu-text">Other Adventures</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./fishing_history.html" rel="" target="">
 <span class="menu-text">About and Contact</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools ms-auto">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">The Refugio System</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>Oh boy, where to even start? I take no joy in reporting that the refugio system on the O is beyond screwed up, though I’m baffled by some of the other comments I’ve seen online. A search of Reddit threads shows people saying that they believe the refugios have lots of supplies, the people are friendly, the services useful, and the food excellent. I have no idea in what year or which universe these people visited the refugios, because my experience was uniformly terrible in myriad ways, both large and small.</p>
<p>The most pressing problem is that the refugios are much, much too small. I have read, and had people tell me on the hike, that the refugios on the back side are now handling 70 people a day. Unfortunately, the refugios are constructed to handle maybe 20 people a day. To give some sense of the problem, at both Seron and Los Perros, there are exactly four bathroom stalls, total. There are approximately 40 to 50 men staying at Seron and Los Perros for anywhere between 8 and 16 hours, and there are exactly two or three toilets to use (two at Seron, three at Los Perros for men). At both places, the days we were there, the toilets became clogged and stopped working. Without getting too graphic, the morning we left Los Perros, people were going to the bathroom in a near-overflowing toilet that wouldn’t flush. There was virtually no soap at any of the refugio bathrooms, and toilet paper was hit-and-miss. The bathrooms, especially at Seron and Los Perros, make the Oktoberfest tent bathrooms look like Donald Trump’s golden toilet.</p>
<p>There were two showers at Seron, something like three at Los Perros, and only a few more at Grey. The front-side refugios are bigger, because they also handle hikers from the W, but are still not big enough. It wasn’t just the shower and bathroom facilities. All hikers must cook in a designated room or tent, and these are much too small at all refugios, except for maybe Frances, which splits traffic with Cuernos and has multiple small cooking rooms. There are lines for everything: check-in, toilets, sinks, cooking space, seating, dish washing, etc. The food was absolute garbage, and the food and accommodations were obscenely overpriced, though buying food and beer from the minimarkets wasn’t that bad.</p>
<p>Look, I recognize this is a hike and I don’t expect five star accommodations. I’m most familiar with wilderness camping using nothing but my own supplies, but the O forces everyone into these small spaces. I’m sure the refugios are hard to resupply, and they are handling too many people in an effort to meet public demand. But still, it would be nice if it wasn’t blindingly obvious that every single person associated with the system has stopped caring. Why bother? Permits for every single day are sold out and there is no shortage of people wanting to do the O hike. It’s really a shame.</p>
<p>I organize this section by refugios this will be how most people encounter the refugios on the hike and certain themes will emerge. I count Centro as a refugio, and note that we skipped Dickson and Chileno, and chose Frances rather than Cuernos because Cuernos was sold out.</p>
<section id="preliminaries" class="level4">
<h4 class="anchored" data-anchor-id="preliminaries">Preliminaries</h4>
<p>Everyone must stay at a refugio. There are a few basic options as to your accommodations, with some variation by refugio. Hikers can stay inside a dorm style building with a bed, outside in a refugio owned tent, outside in a fancier, larger canvas tent, or outside using their own gear. The fancier canvas tents are available at Chileno and Frances for sure, but not any other refugios as far as I’m aware.</p>
<p>At each refugio, there is a designated area to setup your own tent if that’s what you’re doing, as we did. The refugio owned tents have slightly better locations on the grounds in terms of wind-shelter many of them are located on wooden platforms, and they are slightly larger dome-style tents as compared to a typical backpacking tent. For those using their own gear, wooden platforms are mostly not available, though at some refugios (e.g., Seron), you might get lucky.</p>
<p>All refugios have a small market with some basic things like alcohol, candy bars, snacks, etc. though again, the quantity of items varies quite dramatically by refugio. Paine Grande had a full bar (good luck getting a seat or service), but that was the exception. Some of the refugios also had hot food that could be ordered during the day, mostly pizza and burgers. This food is separate from the pre-paid meals that many hikers buy, which are served on a schedule and I would not depend on this food to get through the hike. Because the dining area cannot accommodate everyone at once, the meal service for pre-ordered food is staggered. Again, this is the basic structure, but there is variation among refugios.</p>
<p><strong>For check-in, passports and the PDI card are required</strong>. The PDI card is the print-out given to you when you enter the country of Chile. It apparently entitles you to tax-free charges on the stay, though it wasn’t clear to us what we actually got from it since we booked and paid for our refugios in advance. Still, at check-in, every refugio asked to see it. These requirements are annoying because it means one has to backpack with both their passport and that piece of paper.</p>
</section>
<section id="reservation-system" class="level4">
<h4 class="anchored" data-anchor-id="reservation-system">Reservation System</h4>
<p>I have nothing much interesting to say about the online reservation system. Hikers completing the O must book sites separately at Vertice and Fantastico Sur, the two companies which run the refugios. Good luck lining up dates between the two. This process was incredibly difficult and complicated, and I heard other hikers complain about it as well. There are various websites and Reddit threads that tell you how to book the refugios, but the system to do so is awful, and the page where you pay looks like you’re about to download a virus.</p>
<p>For our trip, we were able to reserve all of our sites using our own gear, except for our last day. Both Cuernos and Frances were sold-out, but Frances had the fancier canvas tents available (for $200). We booked that because we had no choice if we wanted to do the hike on our allotted timeline. Despite our purchase email from Fantastico Sur (which uses the website LasTorres.com and at last check wasn’t working) saying we would receive a separate confirmation email, we never did despite repeated attempts to email Las Torres (in Spanish). It didn’t matter as check-in basically consisted of showing your ID, and the worker checking their list to match your name.</p>
<p>Vertice owns the refugios of Dickson, Los Perros and Grey. Their reservation system <em>requires</em> that you book stays at each of those for three consecutive nights, even though it is not a park requirement that you stop at all three. <a href="./torres_del_paine_hike_details.html">As detailed in the hike summary, it appears to be perfectly acceptable to skip Dickson and go directly to Los Perros from Seron</a>, but Vertice requires you to have a reservation at Dickson. We did just that, and lost our $10. It’s not a lot of money, but demonstrates the general approach Vertice and Fantastico Sur take, which is basically to extract as much profit out of the system as possible.</p>
<p>When booking the refugio stays, there is also an option to purchase breakfast, lunch, and dinner. We faced a decision about how much food we wanted to buy as we were mostly carrying our own gear and our own stove to cook our backpacking food. Still, seven days of food for two people is a lot to carry and would have made our packs very heavy. We decided to carry most of our own food but supplement it with a few meals purchased here and there, simply to reduce our pack weight. The food was almost uniformly awful, with Seron a bit of an exception. If you are a vegetarian, you simply tell them that when you check-in and they will prepare vegetarian meals, including lunches.</p>
</section>
<section id="the-refugios" class="level4">
<h4 class="anchored" data-anchor-id="the-refugios">The Refugios</h4>
<section id="centro" class="level5">
<h5 class="anchored" data-anchor-id="centro">Centro</h5>
<p>Centro is not a refugio proper, but a campground with showers, a bathroom, and a camping space. It’s close to the Welcome Center and the hotel, and provides access to the Base Las Torres hike. It’s also the biggest camping area. We were able to check-in when we arrived at about 9am. The workers simply gave us a sticker, told us to find an empty spot, put up our tent and attach the sticker. The bathroom area was okay (no soap though), the showers were hot in the afternoon, and we were done early enough in the day there was not a line for the showers. The cooking tent is large-ish, though not large enough, and is also where most people drop their packs for the day hike up to Las Torres. Looking back, Centro was neither particularly nice nor objectionable. The bathrooms could have been nicer and cleaner, but the camping area is fine, and hikers are able to spread out a little bit.</p>
</section>
<section id="seron" class="level5">
<h5 class="anchored" data-anchor-id="seron">Seron</h5>
<p>Seron is a Fantastico Sur refugio and seemed to be the second smallest (after Los Perros), but also had the most helpful employees. The camping area is a big field near the buildings, and there was plenty of space to camp away from people if one wanted. However, the wind was howling when we were there, so most people pitched their tent close to the hillside on the northeast or southeast side of the field in order to get some shelter. There were two bathroom stalls and showers separated by gender, though that broke down pretty quickly as lines formed for each. The water was hot and the shower was fine. By the morning, one of the toilets stopped flushing.</p>
<p><img src="fishing_pics/patagonia/seron_camping.JPG" class="img-fluid"> The camping area at Seron for the refugio owned tents on platforms. Lots of space, but not a lot of protection from the wind.</p>
<p>We thought we’d purchased dinner, breakfast, and lunch for Frances, but when we arrived at Seron, the employees told us that we actually had meals there. There are two dinner seatings because the inside dining area at Seron is small. I’m not sure if you could order other food here, but there are coolers with sodas and alcohol, along with some snacks. Our dinner was split pea soup, salmon on rice pilaf, and a shared salad with bread. It was not bad and at the time I thought, okay, the food in these refugios might actually be decent. Breakfast was scrambled eggs, yogurt, and the like, lunch was a salmon, mayo, and onion mix sandwich that was better than it sounds. It also came with some trail mix. The vegetarian version was sauteed, marinated vegetables with fresh tomatoes that the vegetarian in our group thought was good.</p>
</section>
<section id="dickson" class="level5">
<h5 class="anchored" data-anchor-id="dickson">Dickson</h5>
<p>We did not spend the night at Dickson so I can’t provide much feedback on it. The buildings looked nice enough, the cooking and eating area was not heated when we were there, despite being attached to the main building, and the bathroom was small. It was very annoying that when we walked up in the pouring rain we stood around for a minute or two trying to figure out which building to head to for a warmup while a group of employees sat on the porch and watched us without bothering to give us any directions.</p>
<p><img src="fishing_pics/patagonia/dickson.JPG" class="img-fluid"> Dickson camping area.</p>
</section>
<section id="los-perros" class="level5">
<h5 class="anchored" data-anchor-id="los-perros">Los Perros</h5>
<p>The smallest and almost certainly the worst refugio, though our experience at Paine Grande was a close second. The campground itself is in a stand of trees that provided decent shelter from the wind but didn’t offer much space. The cooking and eating area was tiny, and there were queues to do both for most of the night. The cooking tent also become very hot with all the stoves and bodies moving around in there. The bathrooms were tiny and gross, and there was no hot water. People had clearly used the shower to wash off their shoes and mud was splattered everywhere. It had rained a lot so much of the area surrounding the buildings was extremely muddy, which made it difficult to walk around in camp shoes. By the morning, the toilets in both the men’s and women’s bathrooms were clogged and didn’t flush. The whole place was very dirty and didn’t feel taken care of at all.</p>
<p><img src="fishing_pics/patagonia/perros_camping.JPG" class="img-fluid"> The camping area at Los Perros, which wasn tight on space but had decent shelter from the wind.</p>
</section>
<section id="grey" class="level5">
<h5 class="anchored" data-anchor-id="grey">Grey</h5>
<p>Grey is certainly nicer and bigger than both Seron and Los Perros, though the attitude of the employees left something to be desired. The shower and bathroom areas were also larger and cleaner, with hot water and soap. Grey’s cooking and eating area was only three tables, but it felt bigger than either Los Perros or Seron. We ate breakfast at Grey, which consisted of a small buffet with really bad coffee, okay eggs, stale bread (which ran out halfway through service), yogurts, cereals, and juice. We also ordered lunch, and it was terrible. I couldn’t actually tell what the meat-based sandwich was made of, as it looked and tasted like dog food, while the vegetarian option was smashed lime beans on bread that was basically tasteless. They did give us Toblerones in the lunches.</p>
<p>The camping area seemed a bit more spread out and was in pine trees, which provided some protection from the wind and didn’t feel too crowded. Grey might have the nicest camping area in terms of space and privacy.</p>
</section>
<section id="paine-grande" class="level5">
<h5 class="anchored" data-anchor-id="paine-grande">Paine Grande</h5>
<p>The refugio feels much bigger than anything hikers encounter up to that point, but it also feels extremely crowded. The ferry to Pudeto stops at Paine Grande and it is the one refugio that all the W and O hikers share, as well as other hikers who use it as a base to see Grey Glacier. There is a bar upstairs in the refugio, though it was extremely crowded after about 4pm. The bathrooms are relatively far from the camping area, but are basically fine. The problem was that the employees closed them for cleaning at about 8pm, when everyone is getting ready for bed, and they were closed again at about 7am, when everyone was waking up. They couldn’t clean them during off hours? It was nice that both the bathrooms and showers were at least cleaned somewhat regularly, and there were no giant queues to use them. The cooking room at Paine Grande was the biggest and nicest, had the most plugs and outlets of any refugio, and while it seemed a little dirty in the cooking area, the seating area was fine. I heard from some other hikers that the employees kicked them out of the cooking area at exactly 10pm, despite them being in the middle of making their dinner.</p>
<p>We paid for our dinner at Paine, which consisted of a buffet of chicken and beef, along with mashed potatoes, beans, hummus, bread, and some little desserts. The chicken and at least one of the desserts were edible. Breakfast was similarly terrible, with runny eggs, and the standard yogurts, cereals, etc. Lunch was again terrible sandwiches, with the vegetarian option consisting almost entirely of smashed black beans smeared between two pieces of white bread. I can’t remember what the non-vegetarian option was because I threw it out. It baffled me that they gave hikers some energy powder for their water. Who wants to mix that into their bladder or water bottles while on a hike? There was some trail mix, dried fruit, and other stuff, but I basically threw this entire lunch in the trash.</p>
<p>The camping area at Paine Grande is the worst among the refugios. The refugio itself is located at the bottom of a canyon, and the wind blows straight down the canyon all day long, and for us, into the night. There are a few barricades setup to offer some protection to tents, but a lot of the ground behind the barricades was extremely uneven and dusty. We thought we got lucky by being able to setup behind a barricade, but quickly realized that the lack of grass meant dust constantly blew into our tent.</p>
<p><img src="fishing_pics/patagonia/paine_camping.JPG" class="img-fluid"> The camping area at Paine Grande. Good views, but this area completely filled up with tents in the evening, and it was very windy.</p>
<p>It was very crowded, with tents packed into the camping area. On our stay, it began raining around 9 or 10pm, the wind picked up, and nearly every hiker was inside their tent. Because we were all basically on top of each other, talking in one tent meant everyone else could hear their conservation. The crowds also meant that people were walking to and from the distant bathroom all night, and it was just a loud chaotic scene in general.</p>
<p>The employees at Paine were those who most obviously did not give a crap about <em>anything.</em> We went into the minimarket and the woman working the cash register eventually looked up and rang us up after finishing her texts. When we went to check-in, two women didn’t acknowledge us at all, and the woman copped an attitude when some other hikers asked her to explain something in English. The employees blasted EDM at both dinner and breakfast into the dining room. At around 10 or 11pm, between the wind and rain, I could hear loud music and yelling, like teenagers having a party. It was the employees in their own large tent drinking and screaming! Imagine 100 people or so crammed into backpacking tents within about four feet of each other on all sides, preparing for a 13 mile hike in the rain the next day, at midnight, listening to 10 or 15 refugio employees hosting their own personal dance club. It wasn’t cute or funny, just unbelievably unprofessional and annoying. The only saving grace is that sometimes we couldn’t hear them over the wind and rain. And, we weren’t even that close to the party! I cannot believe a hiker didn’t go over to them and tell them off (or maybe they did, and the employees didn’t care). I’m not trying to be a scold as I worked in the service industry for years and I think my tolerance for bad behavior is pretty high; this was completely ridiculous. For what it’s worth, most of the employees in the morning looked hungover.</p>
</section>
<section id="frances" class="level5">
<h5 class="anchored" data-anchor-id="frances">Frances</h5>
<p>Frances is situated in some trees on a hill, and while nice looking, it’s a bit of a haul up and down to the bathrooms and minimart. The buildings look the newest, and the bathrooms and showers seem to be in the best shape. My biggest gripe with Frances, besides the walk up and down to the store and bathrooms, is that there are smaller, separated cooking and eating areas, but they are much too small and don’t provide much protection from the elements. For us in the rain, we were basically cooking and sitting outside, which was cold (though dry). Still, the camping area is a little more spread out and Frances just seemed newer and nicer than the other refugios.</p>
<p><img src="fishing_pics/patagonia/frances_camping.JPG" class="img-fluid"> This is a bad picture, but it’s the inside of our $200 canvas tent. The tent is off the ground and completely encased in heavy canvas with a soft mat on the bottom.</p>
</section>
</section>
<section id="conclusion" class="level4">
<h4 class="anchored" data-anchor-id="conclusion">Conclusion</h4>
<p>The refugio situation should not stop anyone from doing the hike, but everyone should know that the situation is bad. They are small, crowded, dirty, the food is bad, and the employee attitudes ranged from mild indifference to outright hostility. The online booking and reservation system is its own problem. I don’t have much hope for improvement given the overwhelming popularity of the hike, but I think it’s important that hikers realize what they are getting into. Maybe more public complaints to the park or government will force some improvement.</p>
<p><a href="./torres_del_paine_hike_intro.html">Back to O Hike Overview</a></p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>